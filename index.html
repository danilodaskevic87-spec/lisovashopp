<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>–ê–∫–∞—É–Ω—Ç</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    * { box-sizing: border-box }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: radial-gradient(circle at top, #0f172a, #020617);
      color: #e5e7eb;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .card {
      width: 100%;
      max-width: 420px;
      background: rgba(15, 23, 42, 0.95);
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 20px 60px rgba(0,0,0,.5);
    }

    h2, h3 {
      margin-top: 0;
      text-align: center;
    }

    input {
      width: 100%;
      padding: 12px;
      margin-top: 10px;
      border-radius: 10px;
      border: 1px solid #334155;
      background: #020617;
      color: #e5e7eb;
      outline: none;
    }

    input:focus {
      border-color: #38bdf8;
    }

    button {
      width: 100%;
      padding: 12px;
      margin-top: 12px;
      border: none;
      border-radius: 10px;
      background: linear-gradient(135deg, #38bdf8, #6366f1);
      color: #020617;
      font-weight: 600;
      cursor: pointer;
      transition: .2s;
    }

    button.secondary {
      background: #1e293b;
      color: #e5e7eb;
    }

    button:hover {
      transform: translateY(-1px);
      opacity: .95;
    }

    .row {
      display: flex;
      justify-content: space-between;
      margin-top: 10px;
      padding: 10px;
      background: #020617;
      border-radius: 10px;
      border: 1px solid #334155;
    }

    .label {
      color: #94a3b8;
    }

    .value {
      font-weight: 600;
    }

    .msg {
      margin-top: 10px;
      text-align: center;
      color: #fca5a5;
    }
  </style>
</head>
<body>

<div class="card">

  <!-- LOGIN -->
  <div id="loginBox">
    <h2>üîê –í—Ö—ñ–¥</h2>

    <input id="email" placeholder="Email">
    <input id="password" type="password" placeholder="–ü–∞—Ä–æ–ª—å">

    <button id="loginBtn">–£–≤—ñ–π—Ç–∏</button>
    <button id="registerBtn" class="secondary">–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è</button>

    <div class="msg" id="msg"></div>
  </div>

  <!-- PROFILE -->
  <div id="profileBox" style="display:none">
    <h3>üë§ –ú—ñ–π –ø—Ä–æ—Ñ—ñ–ª—å</h3>

    <div class="row">
      <span class="label">üÜî IDD</span>
      <span class="value" id="idd"></span>
    </div>

    <div class="row">
      <span class="label">üë§ –Ü–º º—è</span>
      <span class="value" id="name"></span>
    </div>

    <div class="row">
      <span class="label">üéñÔ∏è –†–∞–Ω–≥</span>
      <span class="value" id="rank"></span>
    </div>

    <div class="row">
      <span class="label">üí∞ –ë–∞–ª–∞–Ω—Å</span>
      <span class="value" id="balance"></span>
    </div>

    <div class="row">
      <span class="label">‚≠ê VIP</span>
      <span class="value" id="vip"></span>
    </div>

    <button onclick="goShop()">üõí –î–æ –º–∞–≥–∞–∑–∏–Ω—É</button>
    <button onclick="logout()" class="secondary">üö™ –í–∏–π—Ç–∏</button>
  </div>

</div>

<script>
/* === Supabase client === */
window.sb = supabase.createClient(
  'https://mefzopeenhfdqfatbjaq.supabase.co',
  'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1lZnpvcGVlbmhmZHFmYXRiamFxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcxOTg1MjQsImV4cCI6MjA4Mjc3NDUyNH0.l_yS9Vd18eb9VFs8i9u-jl9604eUY4l42tdfXEjOdhI'
)

/* LOGIN */
loginBtn.onclick = async () => {
  msg.textContent = '‚è≥ –í—Ö—ñ–¥...'
  const { error } = await sb.auth.signInWithPassword({
    email: email.value,
    password: password.value
  })
  if (error) msg.textContent = error.message
  else loadProfile()
}

/* REGISTER */
registerBtn.onclick = async () => {
  const { error } = await sb.auth.signUp({
    email: email.value,
    password: password.value
  })
  msg.textContent = error ? error.message : 'üìß –ü–µ—Ä–µ–≤—ñ—Ä –ø–æ—à—Ç—É'
}

/* LOAD PROFILE ‚Äî –ì–û–õ–û–í–ù–ï */
async function loadProfile() {
  const { data: userRes } = await sb.auth.getUser()
  const user = userRes.user

  if (!user) return

  const { data, error } = await sb
    .from('bank')
    .select('idd,name,rank,balance,is_vip_user')
    .eq('user_id', user.id)   // üî• –û–ë–û–í º–Ø–ó–ö–û–í–û
    .single()

  if (error || !data) {
    msg.textContent = '‚ùå –ü—Ä–æ—Ñ—ñ–ª—å –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –≤ bank'
    return
  }

  loginBox.style.display = 'none'
  profileBox.style.display = 'block'

  idd.textContent = data.idd ?? '-'
  name.textContent = data.name ?? '-'
  rank.textContent = data.rank
  balance.textContent = data.balance + ' üí∏'
  vip.textContent = data.is_vip_user ? 'YES ‚≠ê' : 'NO'
}

/* LOGOUT */
async function logout() {
  await sb.auth.signOut()
  location.reload()
}

/* SHOP */
function goShop() {
  location.href = 'shop.html'
}

/* AUTO */
loadProfile()
</script>

</body>
</html>
